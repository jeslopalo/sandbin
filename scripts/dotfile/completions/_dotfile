#compdef dotfile

source "$SANDBIN_HOME/scripts/dotfile/lib/dotfile.lib.zsh"

_dotfile() {

    local curcontext="$curcontext" state line
    typeset -A opt_args

    _arguments -C \
        ':command:->command' \
        '*::options:->options'

    case $state in
        (command)
            local -a subcommands;

            subcommands=(
                'list:List all available dotfiles'
            )
            _describe -t commands 'dotfile' subcommands
            _arguments \
                "(-h --help)"{-h,--help}"[Show help for dotfile usage]"
        ;;

        (options)
			case $line[1] in
				(list)
				    _arguments \
				        ':dotfile templates:__dotfile_list' \
				        "(-h --help)"{-h,--help}"[Show help for dotfile list usage]"
                ;;
			esac
		;;
    esac
}

__dotfile_list() {
    local expl
    _wanted dotfile-prefixes expl 'dotfile-prefix' compadd $(available_dotfiles | sed 's/\/.*//' | tr ' ' '\n')
}

_dotfile "$@"
